(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d04dc64e"],{"01e6":function(e,t,s){},"6b83":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container"},[s("div",{staticClass:"filter-container"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:4}},[s("el-input",{attrs:{placeholder:"实验室名",clearable:""},model:{value:e.listQuery.name,callback:function(t){e.$set(e.listQuery,"name",t)},expression:"listQuery.name"}})],1),s("el-col",{attrs:{span:3}},[s("el-select",{attrs:{placeholder:"状态",clearable:""},model:{value:e.listQuery.status,callback:function(t){e.$set(e.listQuery,"status",t)},expression:"listQuery.status"}},e._l(e.statusOptions,(function(e){return s("el-option",{key:e.key,attrs:{label:e.key,value:e.value}})})),1)],1),s("el-col",{attrs:{span:2}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.getDeviceApplyList}},[e._v("搜索")])],1)],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.deviceApplyList}},[s("el-table-column",{attrs:{label:"ID"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.deviceApplyId)+" ")]}}])}),s("el-table-column",{attrs:{label:"设备名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.device.name)+" ")]}}])}),s("el-table-column",{attrs:{label:"设备图片",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("el-image",{staticStyle:{width:"60%"},attrs:{src:e.row.device.imageUrl}})]}}])}),s("el-table-column",{attrs:{label:"申请时间",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("parseTime")(t.row.applyTimestamp,"{y}-{m}-{d} {h}:{i}:{s}"))+" ")]}}])}),s("el-table-column",{attrs:{label:"预计归还时间",width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("parseTime")(t.row.promiseTimestamp,"{y}-{m}-{d} {h}:{i}:{s}"))+" ")]}}])}),s("el-table-column",{attrs:{label:"申请人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.user.name)+" ")]}}])}),s("el-table-column",{attrs:{label:"申请理由"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.borrowReason)+" ")]}}])}),s("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:e._f("statusFilter")(t.row.status,"css")}},[e._v(" "+e._s(e._f("statusFilter")(t.row.status,"content"))+" ")])]}}])}),s("el-table-column",{attrs:{label:"操作",width:"260px"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return e.showProgressDialog(t.row)}}},[e._v("查询流程")])],1),s("el-col",{attrs:{span:8}},["GRANTED"===t.row.status&&t.row.user.userId===e.userId?s("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(s){return e.showUseRecordDialog(t.row)}}},[e._v("上报使用情况")]):e._e()],1)],1),s("div",{staticStyle:{height:"10px"}}),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},["APPLIED"!==t.row.status&&"GRANTED"!==t.row.status||t.row.user.userId!==e.userId?e._e():s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return e.userOperate(t.row)}}},[e._v(e._s(e._f("statusFilter")(t.row.status,"user")))])],1),"ADMIN"===e.role||"SUPER_ADMIN"===e.role?s("el-col",{attrs:{span:16}},["APPLIED"===t.row.status||"RETURNED"===t.row.status?s("el-button",{attrs:{size:"mini"},on:{click:function(s){return e.adminOperate(t.row)}}},[e._v(e._s(e._f("statusFilter")(t.row.status,"admin")))]):e._e(),"APPLIED"===t.row.status?s("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(s){return e.adminOperate(t.row,"GRANTED")}}},[e._v("同意")]):e._e()],1):e._e()],1)]}}])})],1),s("el-dialog",{attrs:{visible:e.progressDialogVisible,title:"申请进度",width:"55%"},on:{"update:visible":function(t){e.progressDialogVisible=t}}},[s("el-steps",{attrs:{active:e.processInfo.step,"align-center":""}},[s("el-step",{attrs:{title:"提交申请",description:e._f("parseTime")(e.processInfo.applyTimestamp,"{y}-{m}-{d} {h}:{i}:{s}")}}),s("el-step",{attrs:{title:"允许借用",description:e._f("parseTime")(e.processInfo.grantTimestamp,"{y}-{m}-{d} {h}:{i}:{s}")}}),s("el-step",{attrs:{title:"提交归还",description:e._f("parseTime")(e.processInfo.returnTimestamp,"{y}-{m}-{d} {h}:{i}:{s}")}}),s("el-step",{attrs:{title:"归还确认",description:e._f("parseTime")(e.processInfo.finishTimestamp,"{y}-{m}-{d} {h}:{i}:{s}")}})],1)],1),s("el-dialog",{attrs:{title:"设备使用情况登记",visible:e.useRecordDialogVisible},on:{"update:visible":function(t){e.useRecordDialogVisible=t}}},[s("h4",{staticStyle:{margin:"0 0 5px 0"}},[e._v("图片上传")]),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://127.0.0.1:8080/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[e.deviceRecord.recordImageUrl?s("img",{staticClass:"avatar",attrs:{src:e.deviceRecord.recordImageUrl,alt:""}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),s("h4",{staticStyle:{margin:"20px 0 5px 0"}},[e._v("备注")]),s("el-input",{attrs:{autosize:{minRows:5,maxRows:10},type:"textarea"},model:{value:e.deviceRecord.description,callback:function(t){e.$set(e.deviceRecord,"description",t)},expression:"deviceRecord.description"}}),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.useRecordDialogVisible=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createRecord()}}},[e._v("提交")])],1)],1),s("el-pagination",{staticStyle:{margin:"40px 0"},attrs:{"page-sizes":[5,10,15,20],"page-size":e.listQuery.pageSize,total:e.totalSize,background:"",layout:"sizes, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},a=[],n=s("5530"),r=s("aa98"),o=s("2f62"),l={getApplyList:r["h"],countApplyList:r["e"],updateApply:r["n"],addRecord:r["c"]},c={APPLIED:{css:"primary",content:"已申请",user:"取消申请",admin:"拒绝"},GRANTED:{css:"success",content:"使用中",user:"归还设备"},RETURNED:{css:"warning",content:"已归还",admin:"归还确认"},FINISHED:{css:"success",content:"已完成"},DENIED:{css:"danger",content:"已拒绝"},CANCELED:{css:"info",content:"已取消"}},u=[{key:"已申请",value:"APPLIED"},{key:"使用中",value:"GRANTED"},{key:"已归还",value:"RETURNED"},{key:"已完成",value:"FINISHED"},{key:"已拒绝",value:"DENIED"},{key:"已取消",value:"CANCELED"}],p={data:function(){return{listLoading:!0,listQuery:{page:1,pageSize:10,name:void 0,status:void 0},totalSize:void 0,deviceApplyList:[],statusOptions:u,progressDialogVisible:!1,processInfo:{step:0,applyTimestamp:void 0,grantTimestamp:void 0,returnTimestamp:void 0,finishTimestamp:void 0},useRecordDialogVisible:!1,deviceRecord:{device:{deviceId:void 0},description:null,recordImageUrl:null}}},filters:{statusFilter:function(e,t){return c[e][t]}},computed:Object(n["a"])({},Object(o["b"])(["role","userId"])),created:function(){this.getDeviceApplyList()},methods:{getDeviceApplyList:function(){var e=this;this.listLoading=!0,""===this.listQuery.status&&(this.listQuery.status=null),l.getApplyList(this.listQuery).then((function(t){e.deviceApplyList=t.data,l.countApplyList(e.listQuery).then((function(t){e.totalSize=t.data}))})),this.listLoading=!1},handleSizeChange:function(e){this.listQuery.pageSize=e,this.getDeviceApplyList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getDeviceApplyList()},showProgressDialog:function(e){this.processInfo={step:0,applyTimestamp:void 0,grantTimestamp:void 0,returnTimestamp:void 0,finishTimestamp:void 0},null!=e.applyTimestamp&&(this.processInfo.step++,this.processInfo.applyTimestamp=e.applyTimestamp),null!=e.grantTimestamp&&(this.processInfo.step++,this.processInfo.grantTimestamp=e.grantTimestamp),null!=e.returnTimestamp&&(this.processInfo.step++,this.processInfo.returnTimestamp=e.returnTimestamp),null!=e.finishTimestamp&&(this.processInfo.step++,this.processInfo.finishTimestamp=e.finishTimestamp),this.progressDialogVisible=!0},userOperate:function(e){var t=this,s=e,i=void 0;"APPLIED"===s.status&&(i="CANCELED"),"GRANTED"===s.status&&(i="RETURNED"),l.updateApply({deviceApplyId:s.deviceApplyId,status:i}).then((function(){t.getDeviceApplyList(),t.$message.success({message:"操作成功",duration:2e3})}))},adminOperate:function(e,t){var s=this,i=e;void 0===t&&("APPLIED"===i.status&&(t="DENIED"),"RETURNED"===i.status&&(t="FINISHED")),l.updateApply({deviceApplyId:i.deviceApplyId,status:t}).then((function(){s.getDeviceApplyList(),s.$message.success({message:"操作成功",duration:2e3})}))},showUseRecordDialog:function(e){this.deviceRecord={device:{deviceId:e.device.deviceId},description:null,recordImageUrl:null},this.useRecordDialogVisible=!0},handleAvatarSuccess:function(e){this.deviceRecord.recordImageUrl=e.data},createRecord:function(){var e=this;l.addRecord(this.deviceRecord).then((function(){e.useRecordDialogVisible=!1,e.$message.success({message:"上报记录成功",duration:2e3})}))}}},d=p,m=(s("7e8a"),s("2877")),f=Object(m["a"])(d,i,a,!1,null,"b3e4737c",null);t["default"]=f.exports},"7e8a":function(e,t,s){"use strict";s("01e6")},aa98:function(e,t,s){"use strict";s.d(t,"m",(function(){return a})),s.d(t,"j",(function(){return n})),s.d(t,"k",(function(){return r})),s.d(t,"f",(function(){return o})),s.d(t,"b",(function(){return l})),s.d(t,"o",(function(){return c})),s.d(t,"g",(function(){return u})),s.d(t,"d",(function(){return p})),s.d(t,"h",(function(){return d})),s.d(t,"e",(function(){return m})),s.d(t,"n",(function(){return f})),s.d(t,"l",(function(){return v})),s.d(t,"c",(function(){return g})),s.d(t,"i",(function(){return h})),s.d(t,"a",(function(){return y}));s("b0c0");var i=s("b775");function a(){return Object(i["a"])({url:"/device/top",method:"GET"})}function n(e){return Object(i["a"])({url:"/device",method:"GET",params:{deviceId:e}})}function r(e){return Object(i["a"])({url:"/device/list",method:"GET",params:{page:e.page-1,pageSize:e.pageSize,name:e.name,status:e.status}})}function o(e){return null==e?Object(i["a"])({url:"/device/list/count",method:"GET"}):Object(i["a"])({url:"/device/list/count",method:"GET",params:{name:e.name,status:e.status}})}function l(e){return Object(i["a"])({url:"/device",method:"POST",data:e})}function c(e){return Object(i["a"])({url:"/device",method:"PUT",data:e})}function u(e){return Object(i["a"])({url:"/device",method:"DELETE",params:{deviceId:e}})}function p(e){return Object(i["a"])({url:"/device/apply",method:"POST",data:e})}function d(e){return Object(i["a"])({url:"/device/apply",method:"GET",params:{page:e.page-1,pageSize:e.pageSize,name:e.name,status:e.status}})}function m(e){return Object(i["a"])({url:"/device/apply/list",method:"GET",params:{page:e.page-1,pageSize:e.pageSize,name:e.name,status:e.status}})}function f(e){return Object(i["a"])({url:"/device/apply",method:"PUT",params:{deviceApplyId:e.deviceApplyId,status:e.status}})}function v(e){return Object(i["a"])({url:"/device/record",method:"GET",params:{deviceId:e}})}function g(e){return Object(i["a"])({url:"/device/record",method:"POST",data:e})}function h(e){return Object(i["a"])({url:"/device/comment",method:"GET",params:{deviceId:e}})}function y(e){return Object(i["a"])({url:"/device/comment",method:"POST",data:e})}}}]);